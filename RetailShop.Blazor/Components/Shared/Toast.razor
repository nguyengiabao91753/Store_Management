<div class="toast-container">
    @if (toasts.Any())
    {
        @foreach (var toast in toasts)
        {
            <div class="toast toast-@toast.Type.ToString().ToLower() @(toast.IsVisible ? "show" : "")">
                <div class="toast-icon">
                    @if (toast.Type == ToastType.Success)
                    {
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 6L9 17l-5-5" />
                        </svg>
                    }
                    else if (toast.Type == ToastType.Error)
                    {
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10" />
                            <line x1="15" y1="9" x2="9" y2="15" />
                            <line x1="9" y1="9" x2="15" y2="15" />
                        </svg>
                    }
                    else if (toast.Type == ToastType.Info)
                    {
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10" />
                            <line x1="12" y1="16" x2="12" y2="12" />
                            <line x1="12" y1="8" x2="12.01" y2="8" />
                        </svg>
                    }
                </div>
                <div class="toast-content">
                    <div class="toast-title">@toast.Title</div>
                    @if (!string.IsNullOrEmpty(toast.Message))
                    {
                        <div class="toast-message">@toast.Message</div>
                    }
                </div>
                <button class="toast-close" @onclick="() => RemoveToast(toast.Id)">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
        }
    }
</div>

@code {
    private List<ToastItem> toasts = new();

    public void ShowToast(string title, string message = "", ToastType type = ToastType.Success, int durationMs = 3000)
    {
        var toast = new ToastItem
        {
            Id = Guid.NewGuid().ToString(),
            Title = title,
            Message = message,
            Type = type,
            IsVisible = false
        };

        toasts.Add(toast);
        StateHasChanged();

        Task.Run(async () =>
        {
            await Task.Delay(10);
            toast.IsVisible = true;
            await InvokeAsync(StateHasChanged);

            await Task.Delay(durationMs);
            toast.IsVisible = false;
            await InvokeAsync(StateHasChanged);

            await Task.Delay(300);
            toasts.Remove(toast);
            await InvokeAsync(StateHasChanged);
        });
    }

    private void RemoveToast(string id)
    {
        var toast = toasts.FirstOrDefault(t => t.Id == id);
        if (toast != null)
        {
            toast.IsVisible = false;
            StateHasChanged();

            Task.Run(async () =>
            {
                await Task.Delay(300);
                toasts.Remove(toast);
                await InvokeAsync(StateHasChanged);
            });
        }
    }

    public class ToastItem
    {
        public string Id { get; set; }
        public string Title { get; set; }
        public string Message { get; set; }
        public ToastType Type { get; set; }
        public bool IsVisible { get; set; }
    }

    public enum ToastType
    {
        Success,
        Error,
        Info
    }
}
