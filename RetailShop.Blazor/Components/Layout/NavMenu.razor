@using RetailShop.Blazor.Models
@using RetailShop.Blazor.Services.IServices
<nav class="main-nav">
    <div class="nav-container">
        <div class="nav-brand">
            <a href="/" class="brand-link">
                <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                    <rect width="32" height="32" rx="8" fill="currentColor" />
                    <path d="M10 16L14 20L22 12" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                <span class="brand-text">RetailShop</span>
            </a>
        </div>

        <input type="checkbox" id="nav-toggle" class="nav-toggle" />
        <label for="nav-toggle" class="nav-toggle-label">
            <span></span>
            <span></span>
            <span></span>
        </label>

        <div class="nav-menu">
            <div class="nav-links">
                <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                        <polyline points="9 22 9 12 15 12 15 22" />
                    </svg>
                    <span>Home</span>
                </NavLink>

                <NavLink class="nav-link" href="products">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="7" width="20" height="14" rx="2" ry="2" />
                        <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" />
                    </svg>
                    <span>Products</span>
                </NavLink>

                @* Added cart preview dropdown wrapper *@
                <div class="nav-cart-wrapper">
                    <NavLink class="nav-link" href="cart">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="9" cy="21" r="1" />
                            <circle cx="20" cy="21" r="1" />
                            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6" />
                        </svg>
                        <span>Cart</span>
                        @if (CartItemCount > 0)
                        {
                            <span class="cart-badge">@CartItemCount</span>
                        }
                    </NavLink>

                    @* Cart preview dropdown *@
                    <div class="cart-preview-dropdown">
                        @if (Carts.Count == 0)
                        {
                            <div class="cart-preview-empty">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <circle cx="9" cy="21" r="1" />
                                    <circle cx="20" cy="21" r="1" />
                                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6" />
                                </svg>
                                <p>Your cart is empty</p>
                            </div>
                        }
                        else
                        {
                            <div class="cart-preview-header">
                                <h3>Shopping Cart</h3>
                                <span class="cart-preview-count">@CartItemCount items</span>
                            </div>
                            <div class="cart-preview-items">
                                @foreach (var item in Carts)
                                {
                                    <div class="cart-preview-item">
                                        <img src="@item.ProductImage" alt="@item.ProductName" />
                                        <div class="cart-preview-item-details">
                                            <h4>@item.ProductName</h4>
                                            <p>@item.Quantity x @item.Price.ToString("C")</p>
                                        </div>
                                        <div class="cart-preview-item-total">
                                            @((item.Price * item.Quantity).ToString("C"))
                                        </div>
                                    </div>
                                }
                            </div>
                            <div class="cart-preview-footer">
                                <div class="cart-preview-subtotal">
                                    <span>Subtotal:</span>
                                    <span class="cart-preview-price">@CartSubtotal.ToString("C")</span>
                                </div>
                                <a href="/cart" class="cart-preview-btn">
                                    View Cart (@CartItemCount)
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="5" y1="12" x2="19" y2="12" />
                                        <polyline points="12 5 19 12 12 19" />
                                    </svg>
                                </a>
                            </div>
                        }
                    </div>
                </div>

                <NavLink class="nav-link" href="orders">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                        <polyline points="14 2 14 8 20 8" />
                        <line x1="16" y1="13" x2="8" y2="13" />
                        <line x1="16" y1="17" x2="8" y2="17" />
                        <polyline points="10 9 9 9 8 9" />
                    </svg>
                    <span>Orders</span>
                </NavLink>
            </div>

            <div class="nav-actions">
                <button class="nav-btn nav-btn-secondary">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8" />
                        <path d="m21 21-4.35-4.35" />
                    </svg>
                </button>
                <UserProfile />
            </div>
        </div>
    </div>
</nav>

@code {
    [Inject]
    public ICartService CartService { get; set; } = default!;

    private List<Cart> Carts { get; set; } = new();
    private int CartItemCount => Carts.Sum(x => x.Quantity);
    private decimal CartSubtotal => Carts.Sum(x => x.TotalAmount!.Value);

    protected override void OnInitialized()
    {
        Carts = CartService.GetCart()
        .OrderByDescending(x => x.CreatedAt)
        .Take(5)
        .ToList();
    }

   
}
