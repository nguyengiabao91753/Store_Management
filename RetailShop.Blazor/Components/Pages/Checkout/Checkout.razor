@page "/checkout"
@using RetailShop.Blazor.Components.Shared
@rendermode InteractiveServer

@inject NavigationManager Nav

<PageTitle>Checkout - MockStore</PageTitle>

<div class="checkout-container">
    <div class="checkout-content">
        <div class="checkout-main">
            <div class="checkout-header">
                <h1>Checkout</h1>
                <div class="breadcrumb">
                    <a href="/cart">Cart</a>
                    <span class="separator">›</span>
                    <span class="active">Checkout</span>
                </div>
            </div>

            <!-- Customer Information -->
            <div class="checkout-section">
                <div class="section-title">
                    <div class="title-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                    </div>
                    <h2>Contact Information</h2>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="customerName">Full Name *</label>
                        <input type="text" 
                               id="customerName" 
                               @bind="orderDto.CustomerName" 
                               placeholder="Enter your full name"
                               class="form-input" />
                        @if (showValidation && string.IsNullOrWhiteSpace(orderDto.CustomerName))
                        {
                            <span class="error-message">Name is required</span>
                        }
                    </div>
                    <div class="form-group">
                        <label for="customerPhone">Phone Number *</label>
                        <input type="tel" 
                               id="customerPhone" 
                               @bind="orderDto.CustomerPhone" 
                               placeholder="Enter your phone number"
                               class="form-input" />
                        @if (showValidation && string.IsNullOrWhiteSpace(orderDto.CustomerPhone))
                        {
                            <span class="error-message">Phone is required</span>
                        }
                    </div>
                </div>
            </div>

            <!-- Payment Method -->
            <div class="checkout-section">
                <div class="section-title">
                    <div class="title-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
                            <line x1="1" y1="10" x2="23" y2="10"/>
                        </svg>
                    </div>
                    <h2>Payment Method</h2>
                </div>
                <div class="payment-methods">
                    <div class="payment-option @(orderDto.PaymentMethod == "Cash" ? "active" : "")" 
                         @onclick='() => SelectPaymentMethod("Cash")'>
                        <div class="payment-radio">
                            <div class="radio-dot"></div>
                        </div>
                        <div class="payment-info">
                            <div class="payment-name">Cash on Delivery</div>
                            <div class="payment-desc">Pay when you receive</div>
                        </div>
                        <div class="payment-icon">💵</div>
                    </div>
                    <div class="payment-option @(orderDto.PaymentMethod == "Card" ? "active" : "")" 
                         @onclick='() => SelectPaymentMethod("Card")'>
                        <div class="payment-radio">
                            <div class="radio-dot"></div>
                        </div>
                        <div class="payment-info">
                            <div class="payment-name">Credit/Debit Card</div>
                            <div class="payment-desc">Visa, Mastercard accepted</div>
                        </div>
                        <div class="payment-icon">💳</div>
                    </div>
                    <div class="payment-option @(orderDto.PaymentMethod == "Banking" ? "active" : "")" 
                         @onclick='() => SelectPaymentMethod("Banking")'>
                        <div class="payment-radio">
                            <div class="radio-dot"></div>
                        </div>
                        <div class="payment-info">
                            <div class="payment-name">Bank Transfer</div>
                            <div class="payment-desc">Direct bank payment</div>
                        </div>
                        <div class="payment-icon">🏦</div>
                    </div>
                </div>
                @if (showValidation && string.IsNullOrWhiteSpace(orderDto.PaymentMethod))
                {
                    <span class="error-message">Please select a payment method</span>
                }
            </div>

            <!-- Promo Code -->
            <div class="checkout-section">
                <div class="section-title">
                    <div class="title-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                            <circle cx="12" cy="10" r="3"/>
                        </svg>
                    </div>
                    <h2>Discount Code</h2>
                </div>
                <div class="promo-input-wrapper">
                    <input type="text" 
                           @bind="promoCode" 
                           placeholder="Enter promo code"
                           class="form-input promo-input" />
                    <button class="btn-apply-promo" @onclick="ApplyPromo">
                        @if (isApplyingPromo)
                        {
                            <span class="spinner"></span>
                        }
                        else
                        {
                            <span>Apply</span>
                        }
                    </button>
                </div>
                @if (!string.IsNullOrEmpty(promoMessage))
                {
                    <div class="promo-message @(promoSuccess ? "success" : "error")">
                        @promoMessage
                    </div>
                }
            </div>
        </div>

        <!-- Order Summary -->
        <div class="checkout-sidebar">
            <div class="order-summary">
                <h3>Order Summary</h3>
                
                <div class="summary-items">
                    @if (cartItems != null && cartItems.Any())
                    {
                        @foreach (var item in cartItems)
                        {
                            <div class="summary-item">
                                <img src="@item.ProductImage" alt="@item.ProductName" />
                                <div class="item-details">
                                    <div class="item-name">@item.ProductName</div>
                                    <div class="item-meta">Qty: @item.Quantity</div>
                                </div>
                                <div class="item-price">@((item.Price * item.Quantity).ToString("C"))</div>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="empty-cart">
                            <p>Your cart is empty</p>
                        </div>
                    }
                </div>

                <div class="summary-divider"></div>

                <div class="summary-row">
                    <span>Subtotal</span>
                    <span>@subtotal.ToString("C")</span>
                </div>
                
                @if (orderDto.DiscountAmount > 0)
                {
                    <div class="summary-row discount">
                        <span>Discount</span>
                        <span>-@orderDto.DiscountAmount?.ToString("C")</span>
                    </div>
                }

                <div class="summary-row">
                    <span>Shipping</span>
                    <span class="free">Free</span>
                </div>

                <div class="summary-divider"></div>

                <div class="summary-row total">
                    <span>Total</span>
                    <span>@orderDto.TotalAmount?.ToString("C")</span>
                </div>

                <button class="btn-place-order" @onclick="PlaceOrder" disabled="@isPlacingOrder">
                    @if (isPlacingOrder)
                    {
                        <span class="spinner"></span>
                        <span>Processing...</span>
                    }
                    else
                    {
                        <span>Place Order</span>
                    }
                </button>

                <div class="trust-badges">
                    <div class="badge">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                        </svg>
                        <span>Secure Checkout</span>
                    </div>
                    <div class="badge">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                        </svg>
                        <span>Free Returns</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<Toast @ref="ToastRef" />




